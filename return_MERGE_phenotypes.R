return_MERGE_phenotypes <- function(merged_data){

  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'PD1__PanCK'] <- 'PD1'
  merged_data <- within(merged_data, {
    f <- merged_data$thres__PanCK__cyto_mean_unique == 1 & merged_data$thres__PD1__cyto_mean_unique == 1 & control_df$sum == 2 
    thres__PanCK__cyto_mean_unique[f] <- 0
  }) 
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD4__PanCK__T_helps__immune_cells'] <- 'CD4'
  merged_data <- within(merged_data, {
    f <- merged_data$thres__CD4__entire_mean == 1 & merged_data$thres__PanCK__cyto_mean_unique == 1 & 
      merged_data$thres__T_helps == 1 & merged_data$thres__immune_cells == 1 & control_df$sum == 4 
    thres__PanCK__cyto_mean_unique[f] <- 0
    }) 
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD8__PanCK__immune_cells'] <- 'CD8'
  merged_data <- within(merged_data, {
    f <- merged_data$thres__CD8__cyto_mean == 1 & merged_data$thres__PanCK__cyto_mean_unique == 1 & 
      merged_data$thres__immune_cells == 1 & control_df$sum == 3 
    thres__PanCK__cyto_mean_unique[f] <- 0}) 
  
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD68__PanCK__immune_cells'] <- 'CD68'

  merged_data <- within(merged_data, {
    f <- merged_data$thres__CD68__cyto_mean == 1 & 
      merged_data$thres__PanCK__cyto_mean_unique == 1 & 
      merged_data$thres__immune_cells == 1 & 
      control_df$sum == 3 
    thres__PanCK__cyto_mean_unique[f] <- 0  }) 
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  
  merged_data$Phenotype[merged_data$Phenotype == 'CD8__PD1__PanCK__PD1_CD8__immune_cells'] <- 'PD1_CD8'   #onomasia opws sta cell densities 
  merged_data <- within(merged_data, {
    f <- merged_data$thres__CD8__cyto_mean == 1 & 
      merged_data$thres__PD1__cyto_mean_unique == 1 & 
      merged_data$thres__PanCK__cyto_mean_unique == 1 & 
      merged_data$thres__PD1_CD8 == 1 & 
      merged_data$thres__immune_cells == 1 & control_df$sum == 5 
    thres__PanCK__cyto_mean_unique[f] <- 0
  }) 
  
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD4__PD1__PanCK__T_helps__PD1_CD4__immune_cells'] <- 'PD1_CD4' #onomasia opws sta cell densities 
  merged_data <- within(merged_data, {
    f <- merged_data$thres__CD4__entire_mean == 1 & 
      merged_data$thres__PD1__cyto_mean_unique == 1 & 
      merged_data$thres__PanCK__cyto_mean_unique == 1 & 
      merged_data$thres__T_helps == 1 & 
      merged_data$thres__PD1_CD4 == 1 & 
      merged_data$thres__immune_cells == 1 & control_df$sum == 6 
    thres__PanCK__cyto_mean_unique[f] <- 0
  }) 
  
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD68__PDL1__PanCK__PDL1_CD68__immune_cells'] <- 'PDL1_CD68'  #onomasia opws sta cell densities 

  merged_data <- within(merged_data, {
    f <- merged_data$thres__CD68__cyto_mean == 1 & 
      merged_data$thres__PDL1__cyto_mean_unique == 1 & 
      merged_data$thres__PanCK__cyto_mean_unique == 1 & 
      merged_data$thres__PDL1_CD68 == 1 & 
      merged_data$thres__immune_cells == 1 & control_df$sum == 5 
    thres__PanCK__cyto_mean_unique[f] <- 0
  }) 
  
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'PanCK__PanCK_PDL1neg'] <- 'PanCK_PDL1neg'                               
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'PDL1__PanCK__PanCK_PDL1pos'] <- 'PanCK_PDL1pos'                          
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD4__PDL1__T_helps__PDL1_CD4__immune_cells'] <- 'PDL1_T_helps'  #   ------> NEW VARIABLE!!!
  merged_data$thres__PDL1_T_helps <- ifelse( merged_data$Phenotype == 'PDL1_T_helps' , 1 , 0)
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'PDL1__CD8__PDL1_CD8__immune_cells'] <- 'PDL1__CD8'         
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD4__T_helps__immune_cells'] <- 'PDL1neg__T_helps'                  #   ------> NEW VARIABLE!!!
  merged_data$thres__PDL1neg_T_helps <- ifelse( merged_data$Phenotype == 'PDL1neg__T_helps' , 1 , 0)
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD4__PD1__T_helps__PD1_CD4__immune_cells'] <- 'PD1__T_helps'        #   ------> NEW VARIABLE!!!
  merged_data$thres__PD1_T_helps <- ifelse( merged_data$Phenotype == 'PD1__T_helps' , 1 , 0)
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD8__PD1__PD1_CD8__immune_cells'] <- 'PD1__CD8'       
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD68__PDL1__PDL1_CD68__immune_cells'] <- 'PDL1__CD68'
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$thres__PDL1_PD1 <- ifelse( merged_data$Phenotype == 'PDL1__PD1' , 1 , 0)
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD4__PDL1__PD1__T_helps__PDL1_CD4__PD1_CD4__PDL1_PD1_CD4__immune_cells'] <- 'PDL1__PD1__T_helps'       #   ------> NEW VARIABLE!!!
  merged_data$thres__PDL1_PD1_T_helps <- ifelse( merged_data$Phenotype == 'PDL1__PD1__T_helps' , 1 , 0)
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD8__immune_cells'] <- 'CD8'
  merged_data$Phenotype[merged_data$Phenotype == 'CD68__immune_cells'] <- 'CD68'  #'macrophages'
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$thres__PDL1_FoxP3 <- ifelse( merged_data$Phenotype == 'PDL1__FoxP3' , 1 , 0)
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'PDL1__CD8__PD1__PDL1_CD8__PD1_CD8__PDL1_PD1_CD8__immune_cells'] <- 'PDL1__PD1__CD8'
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD4__PDL1__FoxP3__T_regs__PDL1_CD4__PDL1_T_regs__immune_cells'] <- 'PDL1__T_regs'
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD4__FoxP3__T_regs__immune_cells'] <- 'T_regs'
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'FoxP3__PD1'] <- 'PD1__T_regs'
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD68__PDL1__PD1__PDL1_CD68__PD1_CD68__PDL1_PD1_CD68__immune_cells'] <- 'PD1__PDL1__CD68'
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'FoxP3__PanCK'] <- 'FoxP3'
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  #---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  merged_data$Phenotype[merged_data$Phenotype == 'CD8__FoxP3__CD8_T_regs__immune_cells'] <- 'CD8__T_regs'

 return(merged_data) 
}